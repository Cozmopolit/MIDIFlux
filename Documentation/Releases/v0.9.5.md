# MIDIFlux v0.9.5 Release Notes

## ÔøΩ MCP Server Overhaul

### Stdio Transport Rewrite
The MCP server was completely non-functional in v0.9.4 ‚Äî the BackgroundService hosting approach was never executed by the .NET host framework, and the default Console logger corrupted the JSON-RPC protocol stream on stdout. The transport layer has been rewritten with a direct stdio loop pattern: the host is used for DI/services only, while stdin/stdout processing runs directly in Main(). Includes a startup error fallback mode for diagnostics.

### 8 New MCP Tools (18 ‚Üí 26 total)
- **midi_update_mapping**: Atomic find-and-replace of mappings by input configuration
- **midi_delete_profile**: Delete profile files with active-profile protection
- **midi_create_profile**: Create empty profiles with minimal configuration
- **midi_update_device**: Update device description without remove+add cycle
- **midi_update_profile_metadata**: Update active profile name/description in memory
- **midi_set_initial_state**: Set, update, or remove initial state values for stateful actions
- **midi_get_system_info**: Runtime diagnostics (MIDI backend, Windows MIDI Services availability, ViGEm driver status)
- Hardened integer parameter parsing ‚Äî MCP tools now accept both JSON numbers and numeric strings

### MCP Profile Activation Fix
Profile switching via MCP now properly activates MIDI processing (opens devices). Previously, `SwitchToProfile()` only loaded configuration into memory without starting device connections.

### MCP MIDI Input Detection Fix
`DetectAsync()` now temporarily opens all available MIDI input devices during detection, making it fully independent of profile state. Detection works as a discovery tool even without a loaded profile.

## üêõ Bug Fixes

- **MIDI output action crash**: `MidiNoteOffAction` and `MidiControlChangeAction` threw `InvalidOperationException` during deserialization when `GetDefaultDescription` was called before JSON parameters were populated
- **5 broken example profiles repaired**: Fixed missing `ErrorHandling` in SequenceActions (`basic-keyboard-shortcuts`, `multi-channel-demo`, `relative-cc-demo`, `unified-profile-sample`) and incorrect parameter keys in `midi-output-basic`
- **SysEx wildcards example**: Updated `example-sysex-wildcards.json` to current action format with Parameters dictionary
- **Double-stop guard**: Prevented duplicate stop during shutdown (explicit stop + host shutdown)

## üîß Improvements

- **Logging**: Removed duplicate MIDI event logging from hardware adapters (single source in MidiDeviceManager), added version/OS/runtime info at startup, added action execution detail logging at DEBUG level, translated remaining German log messages to English
- **Game Controller Demo Profile**: Removed redundant `AxisValue` parameter from axis mappings, added Y-axis inversion hints to thumbstick descriptions
- **DeviceConfig model**: Added `Description` property (was present in JSON profiles but missing from the C# model)
- **Build**: Changed `publish.ps1` default to self-contained single-file build, added assembly version property

## üîó Resources

- **GitHub Repository**: https://github.com/Cozmopolit/MIDIFlux
- **Discord Community**: https://discord.gg/bwNBtQCMKR
- **Documentation**: See `Documentation/User/` for user guides

---

**Full Changelog**: https://github.com/Cozmopolit/MIDIFlux/compare/v0.9.4...v0.9.5

